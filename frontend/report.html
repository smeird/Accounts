<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Reports</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar" id="menu"></nav>
        <main class="content">
            <h1>Transaction Reports</h1>
            <form id="report-form">
                <label>Category ID: <input type="number" id="category"></label>
                <label>Tag ID: <input type="number" id="tag"></label>
                <label>Group ID: <input type="number" id="group"></label>
                <button type="submit">Run Report</button>
            </form>
            <table id="results">
                <thead>
                    <tr><th>Date</th><th>Amount</th><th>Description</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <div id="chart" style="height:400px;margin-top:20px;"></div>
        </main>
    </div>
    <script src="js/menu.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
    document.getElementById('report-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const category = document.getElementById('category').value;
        const tag = document.getElementById('tag').value;
        const group = document.getElementById('group').value;
        const params = new URLSearchParams();
        if (category) params.append('category', category);
        if (tag) params.append('tag', tag);
        if (group) params.append('group', group);
        fetch('../php_backend/public/report.php?' + params.toString())
            .then(resp => resp.json())
            .then(data => {
                const tbody = document.querySelector('#results tbody');
                const chartContainer = document.getElementById('chart');
                tbody.innerHTML = '';
                chartContainer.innerHTML = '';
                if (Array.isArray(data) && data.length) {
                    data.forEach(tx => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `<td>${tx.date}</td><td>${tx.amount}</td><td>${tx.description}</td>`;
                        tbody.appendChild(tr);
                    });
                    const categories = data.map(tx => tx.date);
                    const amounts = data.map(tx => parseFloat(tx.amount));
                    Highcharts.chart('chart', {
                        chart: { type: 'column' },
                        title: { text: 'Transaction Amounts' },
                        xAxis: { categories: categories, title: { text: 'Date' } },
                        yAxis: { title: { text: 'Amount' } },
                        series: [{ name: 'Amount', data: amounts }]
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="3">No transactions found.</td></tr>';
                }
            });
    });
    </script>
    <script src="js/overlay.js"></script>
</body>
</html>
